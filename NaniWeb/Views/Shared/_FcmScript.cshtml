@inject SettingsKeeper SettingsKeeper

@if (bool.Parse(SettingsKeeper.GetSetting("EnableFcm").Value))
{
    <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase-messaging.js"></script>
    <script>
        var config = {
            apiKey: "@SettingsKeeper.GetSetting("FcmApiKey").Value",
            projectId: "@SettingsKeeper.GetSetting("FcmProjectId").Value",
            messagingSenderId: "@SettingsKeeper.GetSetting("FcmSenderId").Value"
        };

        firebase.initializeApp(config);
        const messaging = firebase.messaging();
        var fcmTopic = @Html.Raw(ViewData["FcmTopic"]);
        var subscribeUrl = "@Url.Action("Subscribe", "Subscription", new {topic = " ", token = " "}).Replace("/%20/%20", string.Empty)";
        var unsubscribeUrl = "@Url.Action("Unsubscribe", "Subscription", new {topic = " ", token = " "}).Replace("/%20/%20", string.Empty)";

        $(function() {
            if (window.localStorage.getItem(fcmTopic) === "Subscribed") {
                $("#fcm_toggle").prop("checked", true);
            } else {
                $("#fcm_toggle").prop("checked", false);
            }
        });
        
        $("#fcm_toggle").change(async function() {
            if (this.checked)
                await subscribe();
            else
                await unsubscribe();
        });
    </script>
}